---
interface Props {
    src: string;
    name?: string;
}
const { src, name } = Astro.props;
---

<div class="avatar-frame-wrapper reveal-hidden">
    <div class="avatar-frame">
        <div class="avatar-grain"></div>
        <img
            src={src}
            alt={name || "Profile"}
            class="avatar-img"
            loading="eager"
        />
    </div>
    {
        name && (
            <p
                class="avatar-label font-mono text-xs tracking-widest mt-4"
                style="color: var(--text-muted);"
            >
                {name}
            </p>
        )
    }
</div>

<style>
    .avatar-frame-wrapper {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .avatar-frame {
        position: relative;
        width: 100%;
        max-width: 280px;
        aspect-ratio: 1 / 1;
        overflow: hidden;
        border-radius: 50%;
        /* Inner blur ring using box-shadow */
        box-shadow: inset 0 0 40px 10px var(--bg-primary);
    }

    /* Ocultamos pseudo-elementos anteriores (bordes) o los eliminamos */
    .avatar-frame::before,
    .avatar-frame::after {
        display: none;
    }

    /* Grain overlay adaptado al círculo */
    .avatar-grain {
        position: absolute;
        inset: 0;
        z-index: 2;
        opacity: 0.04;
        pointer-events: none;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        background-size: 128px 128px;
        border-radius: 50%;
    }

    .avatar-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        /* Ponemos la img detrás de la sombra inset interior usando z-index o mix-blend si hiciera falta. 
           En este caso la box-shadow inset del contenedor se superpone directo. */
        position: relative;
        z-index: -1;
        filter: grayscale(30%) contrast(1.05);
        transition: filter 0.5s ease;
        border-radius: 50%;
    }

    .avatar-frame:hover .avatar-img {
        filter: grayscale(0%) contrast(1.02);
    }

    .avatar-label {
        width: 100%;
        text-align: center;
    }

    .avatar-label::before {
        content: "— ";
        opacity: 0.4;
    }
</style>
